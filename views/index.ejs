<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Edit Foto AI ‚Ä¢ ditss</title>
  <meta name="title" content="Edit Foto AI ‚Ä¢ ditss">
  <meta name="description" content="Edit foto dengan AI secara instan. Upload atau masukkan URL, beri prompt, dan dapatkan hasil dalam hitungan detik.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.ditss.biz.id/ai/editing">
  <meta property="og:title" content="Edit Foto AI ‚Ä¢ ditss">
  <meta property="og:description" content="Edit foto dengan AI secara instan. Upload atau masukkan URL, beri prompt, dan dapatkan hasil dalam hitungan detik.">
  <meta property="og:image" content="https://www.ditss.biz.id/assets/img/ai-editor-preview.jpg">
  <meta property="og:image:alt" content="Contoh hasil edit foto menggunakan AI ditss">
  <meta property="og:site_name" content="ditss">
  <meta property="og:locale" content="id_ID">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://www.ditss.biz.id/ai/editing">
  <meta name="twitter:title" content="Edit Foto AI ‚Ä¢ ditss">
  <meta name="twitter:description" content="Edit foto dengan AI secara instan. Upload atau masukkan URL, beri prompt, dan dapatkan hasil dalam hitungan detik.">
  <meta name="twitter:image" content="https://www.ditss.biz.id/assets/img/ai-editor-preview.jpg">
  <meta name="twitter:creator" content="@ditss_store">
  <meta itemprop="name" content="Edit Foto AI ‚Ä¢ ditss">
  <meta itemprop="description" content="Edit foto dengan AI secara instan. Upload atau masukkan URL, beri prompt, dan dapatkan hasil dalam hitungan detik.">
  <meta itemprop="image" content="https://www.ditss.biz.id/assets/img/ai-editor-preview.jpg">
  <link rel="canonical" href="https://www.ditss.biz.id/ai/editing">
  <meta name="robots" content="index, follow">
  <meta name="language" content="Indonesian">
  <meta name="author" content="ditss">
  <meta name="theme-color" content="#4361ee">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" as="style">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" media="print" onload="this.media='all'">
  <style>
    :root {
      --bg-color: #0a0a0f;
      --fg-color: #ffffff;
      --border-color: #2a2a3a;
      --accent-color: #3b82f6;
      --accent-hover: #2563eb;
      --link-color: #60a5fa;
      --card-bg: rgba(255, 255, 255, 0.05);
      --card-bg-solid: #111827;
      --subtle-text: #94a3b8;
      --success-color: #10b981;
      --error-color: #ef4444;
      --warning-color: #f59e0b;
      --gradient-1: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      --gradient-2: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
      --gradient-bg: linear-gradient(135deg, #0f0f23 0%, #1e1b4b 50%, #0c4a6e 100%);
      --slow-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --card-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
      --button-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      height: 100%;
      overflow-x: hidden;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }

    body {
      color: var(--fg-color);
      padding: 20px;
      font-size: 14px;
      background: var(--bg-color);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      overflow-y: auto;
      position: relative;
      min-height: 100vh;
    }
    #particles-js {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
    }

    .gradient-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--gradient-bg);
      opacity: 0.8;
      z-index: -3;
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .main-container { 
      width: 100%; 
      max-width: 500px; 
      padding: 20px 0; 
    }

    .navbar {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: calc(100% - 40px);
      max-width: 500px;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      background: var(--card-bg-solid);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--fg-color);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo i {
      color: var(--accent-color);
    }

    .card, .tool-section {
      background: var(--card-bg-solid);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      width: 100%;
      box-shadow: var(--card-shadow);
      transition: var(--slow-transition);
      position: relative;
      overflow: hidden;
      margin-bottom: 24px;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
      transition: left 0.8s;
    }

    .card:hover::before {
      left: 100%;
    }

    .card {
      padding: 24px;
    }

    header {
      text-align: center;
      padding: 60px 0 30px;
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 12px;
      background: var(--gradient-1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: var(--subtle-text);
      font-size: 1rem;
      line-height: 1.6;
      max-width: 400px;
      margin: 0 auto;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--fg-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-title i {
      color: var(--accent-color);
    }

    .input-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-weight: 500;
      margin-bottom: 8px;
      color: var(--fg-color);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    input, textarea {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      font-size: 14px;
      background: rgba(255, 255, 255, 0.05);
      color: var(--fg-color);
      transition: var(--slow-transition);
      font-family: inherit;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent-color);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    input::placeholder, textarea::placeholder {
      color: var(--subtle-text);
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    /* File Upload Area */
    .file-input-wrapper {
      border: 2px dashed var(--border-color);
      border-radius: 16px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      color: var(--subtle-text);
      transition: var(--slow-transition);
      background: rgba(255, 255, 255, 0.02);
      position: relative;
      overflow: hidden;
    }

    .file-input-wrapper:hover {
      border-color: var(--accent-color);
      background: rgba(59, 130, 246, 0.05);
      transform: translateY(-2px);
    }

    .file-input-wrapper.dragover {
      border-color: var(--accent-color);
      background: rgba(59, 130, 246, 0.1);
      transform: scale(1.02);
    }

    .file-input-wrapper input {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      cursor: pointer;
    }

    .file-icon {
      width: 64px;
      height: 64px;
      background: var(--gradient-1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
    }

    .file-label {
      font-size: 16px;
      font-weight: 600;
      color: var(--fg-color);
    }

    .file-subtitle {
      font-size: 12px;
      color: var(--subtle-text);
    }

    .preview {
      margin-top: 16px;
      text-align: center;
      display: none;
    }

    .preview img {
      max-width: 140px;
      max-height: 140px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    /* Tips Box */
    .tips-box {
      background: rgba(59, 130, 246, 0.1);
      border-left: 4px solid var(--accent-color);
      padding: 12px 16px;
      margin-top: 12px;
      border-radius: 0 8px 8px 0;
      font-size: 13px;
      color: var(--accent-color);
    }

    .tips-box strong {
      color: var(--fg-color);
    }

    .tips-box code {
      background: rgba(59, 130, 246, 0.2);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
    }

    /* Buttons */
    .modern-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 14px 20px;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: var(--slow-transition);
      position: relative;
      overflow: hidden;
      font-family: inherit;
      font-size: 14px;
      width: 100%;
    }

    .modern-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .modern-btn:hover::before {
      left: 100%;
    }

    .modern-btn.primary {
      background: var(--gradient-1);
      color: white;
    }

    .modern-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(59, 130, 246, 0.4);
    }

    .modern-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none !important;
    }

    /* Result Section */
    #result {
      text-align: center;
      padding: 20px 0;
    }

    #result img {
      max-width: 100%;
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      margin-top: 20px;
      border: 1px solid var(--border-color);
    }

    .actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      justify-content: center;
    }

    .action-btn {
      padding: 12px 20px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      background: rgba(255, 255, 255, 0.05);
      color: var(--fg-color);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-weight: 600;
      transition: var(--slow-transition);
      flex: 1;
      max-width: 200px;
      font-size: 13px;
    }

    .action-btn:hover {
      border-color: var(--accent-color);
      background: rgba(59, 130, 246, 0.1);
      transform: translateY(-2px);
    }

    /* Status Messages */
    .status {
      padding: 14px 16px;
      border-radius: 12px;
      margin-top: 16px;
      font-weight: 500;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .success {
      background: rgba(16, 185, 129, 0.1);
      color: #10b981;
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .error {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    /* History Section */
    .history-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      padding: 16px 0;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 20px;
    }

    .history-toggle i {
      margin-left: 8px;
      transition: transform 0.3s ease;
      color: var(--subtle-text);
    }

    .history-toggle.active i {
      transform: rotate(180deg);
    }

    #historySection {
      display: none;
      margin-top: 24px;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .history-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .history-item {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      height: 130px;
      background: var(--border-color);
      position: relative;
      transition: var(--slow-transition);
      border: 1px solid var(--border-color);
    }

    .history-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(59, 130, 246, 0.3);
    }

    .history-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: var(--slow-transition);
    }

    .history-item:hover img {
      transform: scale(1.05);
    }

    .history-item .overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(15, 23, 42, 0.85);
      color: white;
      padding: 8px;
      font-size: 11px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      backdrop-filter: blur(10px);
    }

    /* Footer */
    footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px 0;
      color: var(--subtle-text);
      font-size: 13px;
      border-top: 1px solid var(--border-color);
    }

    /* Loading Animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      body {
        padding: 16px;
      }
      
      .main-container {
        padding: 10px 0;
        max-width: 100%;
      }
      
      .navbar {
        top: 16px;
        width: calc(100% - 32px);
        padding: 14px 20px;
      }
      
      header {
        padding: 80px 0 20px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .card {
        padding: 20px;
      }
      
      .actions {
        flex-direction: column;
      }
      
      .action-btn {
        max-width: 100%;
        justify-content: center;
      }
      
      .history-list {
        grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      }
      
      .history-item {
        height: 110px;
      }
    }

    @media (max-width: 480px) {
      .file-input-wrapper {
        padding: 30px 16px;
      }
      
      .file-icon {
        width: 56px;
        height: 56px;
        font-size: 20px;
      }
      
      .history-list {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- Animated Background -->
  <div id="particles-js"></div>
  <div class="gradient-bg"></div>

  <!-- Navbar -->
  <nav class="navbar glass-effect">
    <a href="/" class="logo">
      <i class="fas fa-wand-magic-sparkles"></i>
      <span>EditFoto<span style="color: var(--accent-color);">AI</span></span>
    </a>
    <div></div>
  </nav>

  <div class="main-container">
    <header>
      <h1>Edit Foto dengan AI</h1>
      <p class="subtitle">Upload foto atau masukkan URL, beri instruksi, dan biarkan AI mengubahnya dalam hitungan detik.</p>
    </header>

    <main class="card glass-effect">
      <h2 class="card-title">
        <i class="fas fa-wand-magic-sparkles"></i>
        Edit Foto AI
      </h2>
        
      <div class="input-group">
        <label for="imageUrl">
          <i class="fas fa-link"></i>
          URL Gambar (opsional)
        </label>
        <input type="url" id="imageUrl" placeholder="https://example.com/foto.jpg">
      </div> 
      
      <div class="input-group">
        <label>
          <i class="fas fa-upload"></i>
          Upload File (opsional)
        </label>
        <div class="file-input-wrapper" id="dropArea">
          <div class="file-icon">
            <i class="fas fa-cloud-upload-alt"></i>
          </div>
          <span class="file-label">Klik atau tarik file gambar</span>
          <span class="file-subtitle">Maks. 10 MB ‚Ä¢ JPG, PNG, GIF, WEBP</span>
          <input type="file" id="file" accept="image/*">
          <div class="preview" id="preview"></div>
        </div>
      </div>

      <div class="input-group">
        <label for="prompt">
          <i class="fas fa-pen"></i>
          Prompt Instruksi Edit
        </label>
        <textarea id="prompt" placeholder="Ketik instruksi... Contoh: ubah jadi gaya anime, tambahkan latar cyberpunk"></textarea>
        <div class="tips-box">
          <strong>Tips:</strong> Ketik <code>/figure</code> untuk prompt otomatis model figure 1/7 scale
        </div>
      </div>

      <button class="modern-btn primary" id="submitBtn">
        <i class="fas fa-sparkles"></i>
        <span id="btnText">Edit Foto Sekarang</span>
      </button>

      <div id="result"></div>
    </main>

    <!-- History Section -->
    <section class="card glass-effect">
      <div class="history-toggle" id="historyToggle">
        <h2 class="card-title" style="margin:0; padding:0;">
          <i class="fas fa-history"></i>
          Riwayat Edit
        </h2>
        <i class="fas fa-chevron-down"></i>
      </div>
      <div id="historySection">
        <div class="history-list" id="historyList">
          <p style="grid-column: 1/-1; text-align: center; color: var(--subtle-text); padding: 20px;">Belum ada riwayat edit</p>
        </div>
      </div>
    </section>

    <footer>
      <p>Dibuat dengan ‚ù§Ô∏è oleh <strong style="color: var(--accent-color);">ditss</strong> ‚Ä¢ API AI Untuk Developer</p>
    </footer>
  </div>
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <script>
particlesJS('particles-js', {
    particles: {
        number: {
            value: 60,
            density: {
                enable: true,
                value_area: 800
            }
        },
        color: {
            value: "#3b82f6"
        },
        shape: {
            type: "circle"
        },
        opacity: {
            value: 0.2,
            random: true
        },
        size: {
            value: 2,
            random: true
        },
        line_linked: {
            enable: true,
            distance: 120,
            color: "#3b82f6",
            opacity: 0.1,
            width: 1
        },
        move: {
            enable: true,
            speed: 1,
            direction: "none",
            random: true,
            straight: false,
            out_mode: "out",
            bounce: false
        }
    },
    interactivity: {
        detect_on: "canvas",
        events: {
            onhover: {
                enable: false
            },
            onclick: {
                enable: false
            }
        }
    },
    retina_detect: true
});
const fileInput = document.getElementById('file');
const preview = document.getElementById('preview');
const dropArea = document.getElementById('dropArea');

// API Base URL
const API_BASE_URL = 'https://ditss.biz.id/api';

fileInput.addEventListener('change', showPreview);

['dragover', 'dragenter'].forEach(e => {
    dropArea.addEventListener(e, ev => {
        ev.preventDefault();
        dropArea.classList.add('dragover');
    });
});

['dragleave', 'dragend'].forEach(e => {
    dropArea.addEventListener(e, () => {
        dropArea.classList.remove('dragover');
    });
});

dropArea.addEventListener('drop', ev => {
    ev.preventDefault();
    dropArea.classList.remove('dragover');
    if (ev.dataTransfer.files.length) {
        fileInput.files = ev.dataTransfer.files;
        showPreview();
    }
});

function showPreview() {
    const file = fileInput.files[0];
    if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = e => {
            preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    } else {
        preview.style.display = 'none';
    }
}

const promptInput = document.getElementById('prompt');
promptInput.addEventListener('input', function() {
    if (this.value.trim() === '/figure') {
        this.value = 'use the model 1/7 scale in the illustration, in a realistic style and environment. place the figure on a computer desk, use in circular transparent acrylic base without any text. on the computer screen, display the 3D modeling process off the figure. next to the computer screen place a tamiya-style toy packaging box printed with the original artwork';
    }
});

document.getElementById('submitBtn').addEventListener('click', async () => {
    const imageUrl = document.getElementById('imageUrl').value.trim();
    const file = fileInput.files[0];
    const prompt = promptInput.value.trim();
    const resultDiv = document.getElementById('result');
    const btn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    
    if (!prompt) return showAlert('Prompt tidak boleh kosong!', 'error');
    if (!imageUrl && !file) return showAlert('Harap masukkan URL atau upload file!', 'error');
    
    btn.disabled = true;
    btnText.textContent = 'Memproses...';
    btn.innerHTML = `<span class="loading"></span> <span>${btnText.textContent}</span>`;
    resultDiv.innerHTML = '';
    
    try {
        let data;
        if (file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('prompt', prompt);
            
            // Menggunakan API_BASE_URL
            const res = await fetch(`${API_BASE_URL}/ai/editfoto2`, { 
                method: 'POST', 
                body: formData 
            });
            data = await res.json();
        } else {
            // Menggunakan API_BASE_URL
            const url = `${API_BASE_URL}/ai/editfoto2?url=${encodeURIComponent(imageUrl)}&prompt=${encodeURIComponent(prompt)}`;
            const res = await fetch(url);
            data = await res.json();
        }
        
        if (!data.status) throw new Error(data.error);
        showResult(data.result.imageUrl, prompt);
    } catch (err) {
        showAlert(`‚ùå ${err.message}`, 'error');
    } finally {
        btn.disabled = false;
        btnText.textContent = 'Edit Foto Sekarang';
        btn.innerHTML = `<i class="fas fa-sparkles"></i> <span>${btnText.textContent}</span>`;
    }
});

function showAlert(message, type) {
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = `<div class="status ${type}"><i class="fas fa-${type === 'error' ? 'exclamation-triangle' : 'check-circle'}"></i>${message}</div>`;
    setTimeout(() => { resultDiv.innerHTML = ''; }, 5000);
}

async function downloadImage(url) {
    try {
        showAlert('‚è≥ Memulai download...', 'success');
        
        // Menggunakan API_BASE_URL untuk proxy download
        const proxyUrl = `${API_BASE_URL}/proxy/download?url=${encodeURIComponent(url)}`;
        const link = document.createElement('a');
        link.href = proxyUrl;
        const filename = url.split('/').pop() || `ditss_ai_${Date.now()}.jpg`;
        link.download = filename;
        link.target = '_self';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        setTimeout(() => {
            showAlert('‚úÖ Download berhasil!', 'success');
        }, 1000);
    } catch (error) {
        console.error('Download error:', error);
        showAlert('‚ùå Gagal mendownload. Coba klik kanan -> Save Image As', 'error');
    }
}

async function shareImage(url) {
    try {
        const text = 'Lihat hasil edit foto AI keren ini dari: https://www.ditss.biz.id/ai/editing üöÄ\n';
        if (navigator.share) {
            await navigator.share({
                title: 'Hasil Edit Foto AI - Ditss Store',
                text: text,
                url: url
            });
            showAlert('‚úÖ Berhasil dibagikan!', 'success');
        } else if (navigator.clipboard) {
            await navigator.clipboard.writeText(`${text}${url}`);
            showAlert('üìã Link disalin ke clipboard!', 'success');
        } else {
            prompt('Salin link berikut:', url);
            showAlert('üìã Link siap untuk disalin!', 'success');
        }
    } catch (error) {
        console.error('Share error:', error);
        showAlert('‚ùå Gagal membagikan', 'error');
    }
}

function showResult(imgPath, prompt) {
    const fullUrl = imgPath.startsWith('http') ? imgPath : `${window.location.origin}${imgPath}`;
    const resultDiv = document.getElementById('result');
    
    resultDiv.innerHTML = `
        <div class="status success">
            <i class="fas fa-check-circle"></i> Edit berhasil!
        </div>
        <img src="${fullUrl}?t=${Date.now()}" alt="Hasil AI" id="resultImage" style="max-width: 100%; border-radius: 16px; margin: 20px 0;">
        <div class="image-info">
            <div class="info-item">
                <strong>URL Hasil:</strong>
                <div class="url-container">
                    <input type="text" value="${fullUrl}" readonly id="resultUrl">
                    <button class="copy-url-btn" onclick="copyResultUrl()">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="actions">
            <button class="action-btn" onclick="downloadImage('${fullUrl}')">
                <i class="fas fa-download"></i> Download
            </button>
            <button class="action-btn" onclick="shareImage('${fullUrl}')">
                <i class="fas fa-share-alt"></i> Bagikan
            </button>
            <button class="action-btn" onclick="openInNewTab('${fullUrl}')">
                <i class="fas fa-external-link-alt"></i> Buka
            </button>
        </div>
    `;
    saveToHistory({ imageUrl: fullUrl, prompt });
}

function copyResultUrl() {
    const urlInput = document.getElementById('resultUrl');
    urlInput.select();
    document.execCommand('copy');
    showAlert('üìã URL disalin ke clipboard!', 'success');
}

function openInNewTab(url) {
    window.open(url, '_blank');
}

function saveToHistory({ imageUrl, prompt }) {
    const history = getHistory();
    const historyItem = {
        imageUrl,
        prompt,
        timestamp: Date.now(),
        id: 'hist_' + Date.now() + Math.random().toString(36).substr(2, 5)
    };
    
    history.unshift(historyItem);
    if (history.length > 20) history.pop();
    localStorage.setItem('ditss_ai_history', JSON.stringify(history));
    renderHistory();
}

function getHistory() {
    const data = localStorage.getItem('ditss_ai_history');
    return data ? JSON.parse(data) : [];
}

function renderHistory() {
    const history = getHistory();
    const list = document.getElementById('historyList');
    const toggle = document.getElementById('historyToggle');
    
    if (history.length === 0) {
        list.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--subtle-text); padding: 20px;">Belum ada riwayat edit</p>';
        return;
    }
    
    list.innerHTML = history.map((item) => `
        <div class="history-item">
            <img src="${item.imageUrl}" onerror="this.style.display='none'" alt="History ${item.id}">
            <div class="history-overlay">
                <div class="history-prompt">${item.prompt.substring(0, 30)}${item.prompt.length > 30 ? '...' : ''}</div>
                <div class="history-actions">
                    <button class="history-action-btn" onclick="previewHistoryItem('${item.id}')" title="Preview">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="history-action-btn" onclick="downloadImage('${item.imageUrl}')" title="Download">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="history-action-btn" onclick="shareImage('${item.imageUrl}')" title="Share">
                        <i class="fas fa-share-alt"></i>
                    </button>
                    <button class="history-action-btn" onclick="useHistoryPrompt('${item.id}')" title="Gunakan Prompt">
                        <i class="fas fa-recycle"></i>
                    </button>
                    <button class="history-action-btn delete" onclick="deleteHistoryItem('${item.id}')" title="Hapus">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>
    `).join('');
    
    document.getElementById('historySection').style.display = 'block';
    toggle.style.display = 'flex';
}

function previewHistoryItem(itemId) {
    const history = getHistory();
    const item = history.find(h => h.id === itemId);
    if (!item) return;
    const modal = document.createElement('div');
    modal.className = 'history-preview-modal';
    modal.innerHTML = `
        <div class="modal-overlay" onclick="this.parentElement.remove()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h3>Preview Hasil</h3>
                    <button class="modal-close" onclick="this.closest('.history-preview-modal').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <img src="${item.imageUrl}" alt="Preview" style="max-width: 100%; border-radius: 12px;">
                    <div class="modal-prompt">
                        <strong>Prompt:</strong> ${item.prompt}
                    </div>
                    <div class="modal-actions">
                        <button class="action-btn" onclick="downloadImage('${item.imageUrl}')">
                            <i class="fas fa-download"></i> Download
                        </button>
                        <button class="action-btn" onclick="shareImage('${item.imageUrl}')">
                            <i class="fas fa-share-alt"></i> Share
                        </button>
                        <button class="action-btn" onclick="useHistoryPrompt('${item.id}')">
                            <i class="fas fa-recycle"></i> Gunakan Prompt
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    addModalStyles();
}

function useHistoryPrompt(itemId) {
    const history = getHistory();
    const item = history.find(h => h.id === itemId);
    if (!item) return;
    
    document.getElementById('prompt').value = item.prompt;
    showAlert('üìù Prompt telah dimasukkan!', 'success');
    
    const modal = document.querySelector('.history-preview-modal');
    if (modal) modal.remove();
}

function deleteHistoryItem(itemId) {
    if (!confirm('Hapus item ini dari riwayat?')) return;
    
    const history = getHistory();
    const newHistory = history.filter(h => h.id !== itemId);
    localStorage.setItem('ditss_ai_history', JSON.stringify(newHistory));
    renderHistory();
    showAlert('üóëÔ∏è Item dihapus dari riwayat', 'success');
}

function addModalStyles() {
    if (document.getElementById('modal-styles')) return;
    
    const styles = document.createElement('style');
    styles.id = 'modal-styles';
    styles.textContent = `
        .history-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
        }
        .modal-overlay {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-content {
            background: var(--card-bg-solid);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-header h3 {
            color: var(--fg-color);
            font-size: 1.25rem;
        }
        .modal-close {
            background: none;
            border: none;
            color: var(--subtle-text);
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
        }
        .modal-close:hover {
            background: rgba(255,255,255,0.1);
        }
        .modal-prompt {
            margin: 16px 0;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.4;
        }
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .url-container {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        .url-container input {
            flex: 1;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 12px;
            color: var(--fg-color);
        }
        .copy-url-btn {
            background: var(--accent-color);
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            color: white;
            cursor: pointer;
            transition: var(--slow-transition);
        }
        .copy-url-btn:hover {
            background: var(--accent-hover);
        }
        .image-info {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
        }
        .info-item {
            margin-bottom: 12px;
        }
        .info-item:last-child {
            margin-bottom: 0;
        }
    `;
    document.head.appendChild(styles);
}

const historyStyles = document.createElement('style');
historyStyles.textContent = `
    .history-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(15, 23, 42, 0.9);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 8px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .history-item:hover .history-overlay {
        opacity: 1;
    }
    .history-prompt {
        color: white;
        font-size: 11px;
        line-height: 1.3;
        margin-bottom: 8px;
    }
    .history-actions {
        display: flex;
        gap: 4px;
        justify-content: center;
    }
    .history-action-btn {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        border: none;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        transition: all 0.2s ease;
    }
    .history-action-btn:hover {
        background: var(--accent-color);
        transform: scale(1.1);
    }
    .history-action-btn.delete:hover {
        background: var(--error-color);
    }
`;
document.head.appendChild(historyStyles);

document.getElementById('historyToggle').addEventListener('click', function() {
    const section = document.getElementById('historySection');
    const icon = this.querySelector('i');
    
    if (section.style.display === 'none' || section.style.display === '') {
        section.style.display = 'block';
        this.classList.add('active');
    } else {
        section.style.display = 'none';
        this.classList.remove('active');
    }
});

renderHistory();

document.getElementById('imageUrl').addEventListener('input', function() {
    if (this.value.trim() !== '') {
        fileInput.value = '';
        preview.style.display = 'none';
    }
});

promptInput.addEventListener('paste', function(e) {
    e.preventDefault();
    const text = e.clipboardData.getData('text');
    this.value = this.value.substring(0, this.selectionStart) + text + this.value.substring(this.selectionEnd);
    if (text.trim() === '/figure') {
        this.value = 'use the model 1/7 scale in the illustration, in a realistic style and environment. place the figure on a computer desk, use in circular transparent acrylic base without any text. on the computer screen, display the 3D modeling process off the figure. next to the computer screen place a tamiya-style toy packaging box printed with the original artwork';
    }
});

const link = document.createElement('link');
link.href = 'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap';
link.rel = 'stylesheet';
document.head.appendChild(link);
  </script>
</body>
</html>
